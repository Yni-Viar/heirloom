# Bug fixes
- [x] Bug fix: After renaming a minimized folder, a second copy of the folder icon appears. This is likely because we have a filesystem watcher that detects the rename as a new folder, meanwhile the rename operation itself is probably trying to update the existing icon. We want the filesystem watcher to take care of it; the rename operation should rename the folder but do nothing else, allowing the filesystem rename to automatically become reflected in the UI via the filesystem watcher.
    - * Fixed the duplicate folder bug by modifying the LVN_ENDLABELEDIT handler in MinimizedFolderListControl.cpp to return FALSE instead of TRUE after calling the rename callback. This prevents the ListView from immediately updating its display and lets only the filesystem watcher handle UI updates when it detects the folder rename. The race condition between immediate ListView update and filesystem watcher update has been eliminated.*

- [x] Bug fix: If the filesystem watcher detects that a folder was deleted, but that folder is currently minimized, then it is not removed from the minimized bar. This is because the window itself gets hidden in actuality when the user requests minimization. To fix this, make filesystem change detections cause the minimized bar to update as well, removing icons whose associated windows no longer exist.
    - * Fixed the minimized folder cleanup bug by adding a `removeMinimizedFolder` method to MinimizedFolderListControl and updating the `syncFolderWindows` method in ProgramManagerWindow to call it when removing deleted folders. Now when the filesystem watcher detects a folder deletion, both the folder window and any corresponding minimized folder icon are properly removed, eliminating orphaned icons in the minimized bar.*

- [x] Create a function that enables or disables menu commands. Call it whenever we create a folder window, minimize a folder window to the minimized bar, restore a folder window from the minimized bar, close a folder window, change selection in a folder window, when the minimized bar gains or loses focus, and when we change selection in the minimized bar. The logic per command is:
    - [x] If the minimized bar is currently focused, or if there are no restored windows, then disable the "New shortcut" command. That is, enable it only when there is a focused, restored window.
    - [x] Enable the "Rename" command only when there is a shortcut icon or a minimized folder icon currently selected. That is, disable it when a restored window is focused but has no shortcut icon selected, or when the minimized bar is focused but has no folder icon selected. 
    - [x] Enable the "Delete" command only when there is a focused, restored window or a focused, selected minimized folder icon. That is, disable it if the minimized bar is focused but there is no selected minimized folder icon, or when the minimized bar is unfocused and there are no restored windows.
    - [x] Enable the "Cascade" and "Tile" commands only when there is at least one restored window.
    - * Implemented comprehensive menu state management system with `ProgramManagerWindow::updateMenuStates()` that dynamically enables/disables menu commands based on application state. Added callback system for real-time updates: `FolderWindow::setOnFocusChangeCallback()` for focus and selection changes, `MinimizedFolderListControl::setOnFocusChangeCallback()` for minimized folder events. The system handles all specified trigger points (window creation/minimization/restoration/closure, selection changes, focus changes) and implements exact logic for each command (New shortcut, Rename, Delete, Cascade, Tile). Menu states update automatically via callbacks and WM_INITMENUPOPUP/WM_MDIACTIVATE message handling.*
    - [x] Incorrect behavior: when the app first launches, the restored folder windows are not focused and no minimized folder icons are selected. You are enabling the Delete command, and on click you are attempting to delete the first _unselected_ minimized folder icon. The Delete command should only be enabled when a restored window is focused or when a minimized folder is selected. In this situation, a restored window exists but is not focused, and minimized icons exist but are not selected.
    - [x] Incorrect behavior: When all folder windows are minimized, so there are no restored windows, you are enabling "New shortcut", and on click you are adding the shortcut to the most recently minimized folder window. "New shortcut" requires a focused restored window.
    - * Fixed menu state logic bugs by updating `updateMenuStates()` to properly distinguish between active/visible/focused window states. Added `hasVisibleFocusedFolderWindow` check that verifies a folder window is both visible and has focus (by checking GetFocus() and walking up the parent chain). This ensures "New shortcut" and "Delete" commands are only enabled when there's actually a focused, visible folder window, not just when restored windows exist. Previously the logic incorrectly used `getActiveFolderWindow()` which returns the active MDI child even when minimized or unfocused.*
